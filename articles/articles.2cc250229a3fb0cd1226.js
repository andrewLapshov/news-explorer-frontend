!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=13)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(){this._handlers=[],this.setListeners=this.setListeners.bind(this)}setListeners(e){this._saveListeners(e),this._addEventListeners()}_saveListeners(e){e.forEach(e=>{let{event:t,element:s,callback:r}=e;const n=r.bind(this);this._handlers.push({event:t,element:s,bindedCallback:n})})}_addEventListeners(){this._handlers.forEach(e=>{let{event:t,element:s,bindedCallback:r}=e;"function"==typeof r&&("window"===s?window.addEventListener(t,r):"element"===s?this._element.addEventListener(t,r):this._element.querySelector(s).addEventListener(t,r))})}_removeListeners(){this._handlers.forEach(e=>{let{event:t,element:s,bindedCallback:r}=e;"window"===s?window.removeEventListener(t,r):"element"===s?this._element.removeEventListener(t,r):this._element.querySelector(s).removeEventListener(t,r)})}}},function(e,t,s){"use strict";t.a=(e,t,s)=>{t?"function"==typeof e.text?e.text().then(e=>t(JSON.parse(e).message)):"Failed to fetch"===e.message?t(s):t(e):alert(e)}},function(e,t,s){"use strict";t.a={ALREADY_EXIST_ERROR:"Такой пользователь уже есть",WRONG_EMAIL_ERROR:"Адрес почты указан в неверном формате",MISSING_VALUE_ERROR:"Необходимо заполнить поле",MISSING_SEARCH_VALUE_ERROR:"Нужно ввести ключевое слово",TYPE_SEARCH_VALUE:"Введите тему новости",PASSWORD_LENGTH_ERROR:"Пароль должен быть минимум 8 символов",NAME_LENGTH_ERROR:"Имя должно быть от 2 до 30 символов",NO_RESULT:"Ничего не найдено",NO_ARTICLES:"нет",GET_RESULT_ERROR:"Во время запроса произошла ошибка. Возможно, проблема с соединением или сервер недоступен. Подождите немного и попробуйте ещё раз",NO_INTERNET:"Проблема с Интернет-соединением"}},function(e,t,s){"use strict";t.a={SERVER_URL:"https://api.newsapp.tk",NEWSAPI_URL:"https://newsapi.org/v2/everything",NEWSAPI_TOKEN:"e36d3cbd9fac495ebacbbb8a437e8a11",ESCAPE_CODE:27,ONE_DAY:864e5,LAST_DAY:7,CARD_AMOUNT:3}},function(e,t,s){"use strict";var r=s(1);t.a=(e,t,s)=>{e.getUserData().then(e=>{t.render({isLoggedIn:!0,userName:e.data.name}),s&&s.setUsername(e.data.name)}).catch(e=>{Object(r.a)(e)})}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var r=s(0);class n extends r.a{constructor(e,t){super(),this._element=e,this._isArticlesUrl=t,this._articlesLink=this._element.querySelector(".header__list-item_articles"),this._buttonIcon=this._element.querySelector(".header__button-icon"),this._buttonText=this._element.querySelector(".header__button-text"),this._menu=this._element.querySelector(".header__menu"),this._list=this._element.querySelector(".header__list"),this._overlay=this._menu.querySelector(".header__menu-overlay")}render(e){e.isLoggedIn?(this._articlesLink.style.display="inline-block",this._buttonIcon.style.display="block",this._buttonText.textContent=e.userName):(this._articlesLink.style.display="none",this._buttonIcon.style.display="none",this._buttonText.textContent="Авторизоваться")}checkMenuState(){return!(!this._menu.classList.contains("header__menu_is-active_white")&&!this._menu.classList.contains("header__menu_is-active_black"))}toggleMenuButton(){this._isArticlesUrl?this._menu.classList.toggle("header__menu_is-active_black"):this._menu.classList.toggle("header__menu_is-active_white")}toggleMenu(){this._isArticlesUrl||this._element.classList.toggle("header_state_dropdown"),this._list.classList.toggle("header__list_is-active"),this._overlay.classList.toggle("header__menu-overlay_is-active"),document.body.classList.toggle("body_is-hidden")}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var r=s(0);class n extends r.a{constructor(e,t){super(),this._element=e,this._isArticles=t,this._message=this._element.querySelector(".results__message"),this._cardlist=this._element.querySelector(".results__list"),this._preloader=this._element.querySelector(".preloader"),this.cardsData=null,this.counter=null,this.renderedCards=[],this._initializeSearchResultsElems(),this.setMessageError=this.setMessageError.bind(this)}_initializeSearchResultsElems(){this._isArticles||(this._moreCards=this._element.querySelector(".results__button"),this._noResults=this._element.querySelector(".results__no-results"))}show(){this._isArticles||(this.toggleNoResults(!1),this.toggleMoreCards(!1)),this._message.textContent="",this.togglePreloader(!0),this._element.classList.add("results_is-active")}hide(){this._element.classList.remove("results_is-active")}insertElement(e){this._cardlist.append(e)}togglePreloader(e){e?this._preloader.classList.add("preloader_is-active"):this._preloader.classList.remove("preloader_is-active")}toggleMoreCards(e){e?this._moreCards.classList.add("results__button_active"):this._moreCards.classList.remove("results__button_active")}toggleNoResults(e){e?this._noResults.classList.add("results__no-results_is-active"):this._noResults.classList.remove("results__no-results_is-active")}setMessageError(e){this._message.textContent=e}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var r=s(0);class n extends r.a{constructor(e,t){super(),this._element=document.querySelector(t).content.cloneNode(!0).querySelector(".card__wrapper"),this._data=e,this._id=null,this._cardEventCallback=null,this._textWrapper=this._element.querySelector(".card__text-wrapper"),this._setData(this._data),this.truncateCardText=this.truncateCardText.bind(this),setTimeout(this.truncateCardText,10)}truncateCardText(){const e=this._textWrapper.clientWidth*this._textWrapper.clientHeight/245;this._element.querySelector(".card__text").textContent=`${this._data.text.substr(0,e)}...`}remove(){this._removeListeners(),this._element.remove()}_setData(e){this._element.querySelector(".card__source").textContent=e.source,this._element.querySelector(".card__title").textContent=e.title,this._element.querySelector(".card__date").textContent=n._setFormattedDate(e.date),this._element.querySelector(".card__text").textContent=e.text,this._element.querySelector(".card__image").style.backgroundImage=`url('${e.image}')`,this._element.querySelector(".card__keyword")&&(this._element.querySelector(".card__keyword").textContent=e.keyword)}static _setFormattedDate(e){const t=new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"long",year:"numeric"}),[{value:s},,{value:r},,{value:n}]=t.formatToParts(new Date(e));return`${s} ${r}, ${n}`}set id(e){this._id=e}get id(){return this._id}get node(){return this._element}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class r{constructor(e){this._url=e.url}static getJSONResponse(e){return e.ok?e.json():Promise.reject(e)}signup(e){const{name:t,email:s,password:n}=e;return fetch(`${this._url}/signup`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:t,email:s,password:n})}).then(e=>r.getJSONResponse(e))}signin(e){const{email:t,password:s}=e;return fetch(`${this._url}/signin`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({email:t,password:s})}).then(e=>r.getJSONResponse(e))}getUserData(){return fetch(`${this._url}/users/me`,{headers:{authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>r.getJSONResponse(e))}addBookmark(e){return fetch(`${this._url}/articles`,{headers:{"Content-Type":"application/json",authorization:`Bearer ${localStorage.getItem("token")}`},method:"POST",body:JSON.stringify(e)}).then(e=>r.getJSONResponse(e))}deleteBookmark(e){return fetch(`${this._url}/articles/${e}`,{headers:{"Content-Type":"application/json",authorization:`Bearer ${localStorage.getItem("token")}`},method:"DELETE"}).then(e=>r.getJSONResponse(e))}getArticles(){return fetch(`${this._url}/articles`,{headers:{authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>r.getJSONResponse(e))}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return n}));const r=(e,t)=>{!window.matchMedia("(max-width: 650px)").matches&&e.checkMenuState()?(t.isOpened||e.toggleMenu(),e.toggleMenuButton()):window.matchMedia("(max-width: 650px)").matches&&!e.checkMenuState()&&t.isOpened&&e.toggleMenuButton()},n=e=>{!window.matchMedia("(max-width: 650px)").matches&&e.checkMenuState()&&(e.toggleMenu(),e.toggleMenuButton())}},,function(e,t,s){},,function(e,t,s){"use strict";s.r(t);s(11);var r=s(3),n=s(2),i=s(5),a=s(6),o=s(7),l=s(0);var c={NOMINATIVE_CASE:" сохранённая статья",GENITIVE_CASE:" сохранённые статьи",ACCUSATIVE_CASE:" сохранённых статей"};const{NOMINATIVE_CASE:_,GENITIVE_CASE:u,ACCUSATIVE_CASE:h}=c,{NO_ARTICLES:d}=n.a;class m extends l.a{constructor(e){super(),this._element=e,this._counterDOM=this._element.querySelector(".article-info__counter"),this._username=this._element.querySelector(".article-info__name"),this._text=this._element.querySelector(".article-info__text"),this._keywords=this._text.querySelector(".article-info__keywords"),this._saved=this._element.querySelector(".article-info__saved"),this._summary={},this.counter=0}setUsername(e){this._username.textContent=e}createSummary(e){this._summary[e]?this._summary[e]+=1:this._summary[e]=1}changeSummary(e){this.counter-=1,this._summary[e]-=1,this._summary[e]||delete this._summary[e],this.sortSummary()}sortSummary(){const e={};Object.keys(this._summary).sort((e,t)=>this._summary[t]-this._summary[e]).forEach(t=>{e[t]=this._summary[t]}),this._summary=e,this._render()}_setInfo(){let e;const t=Object.keys(this._summary);return t.length>0&&t.length<=3&&(e=t.join(", ")),t.length>3&&(e=`${t[0]}, ${t[1]} и ${t.length-2} другим`),e}static _setCases(e,t){return t[e%100>4&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]}_render(){0===this.counter?(this._counterDOM.textContent=d,this._text.style.display="none"):(this._counterDOM.textContent=this.counter,this._keywords.textContent=this._setInfo(),this._text.style.display="block"),this._saved.textContent=m._setCases(this.counter,[_,u,h])}}var g=s(8),y=s(4),S=s(1),p=s(9);const{GET_RESULT_ERROR:E}=n.a,f=new g.a({url:r.a.SERVER_URL}),v=new i.a(document.querySelector(".header"),!0),b=new a.a(document.querySelector(".results"),!0),w=new m(document.querySelector(".article-info"));window.addEventListener("resize",()=>Object(p.b)(v)),localStorage.getItem("token")?Object(y.a)(f,v,w):window.location.href="../";v.setListeners([{event:"click",element:".header__button",callback:e=>(e=>{e.preventDefault(),localStorage.removeItem("token"),window.location.href="../"})(e)},{event:"click",element:".header__menu",callback:e=>(e=>{window.matchMedia("(max-width: 650px)").matches&&e.target.classList.contains("header__menu")&&(v.toggleMenuButton(),v.toggleMenu())})(e)}]);b.show(),f.getArticles().then(e=>{b.togglePreloader(!1),e.data.forEach(e=>{w.createSummary(e.keyword);const t=new o.a(e,".card-bookmark-template");t.setListeners([{event:"click",element:".card__corner-button",callback:s=>((e,t,s)=>{e.preventDefault(),e.stopPropagation(),window.confirm("Вы действительно хотите удалить эту новость?")&&f.deleteBookmark(s._id).then(()=>{w.changeSummary(s.keyword),t.remove(),b.renderedCards.pop(),0===b.renderedCards.length&&b.hide()}).catch(e=>{Object(S.a)(e)})})(s,t,e)},{event:"click",element:".card",callback:()=>{window.open(e.link,"_blank")}},{event:"resize",element:"window",callback:t.truncateCardText}]),b.renderedCards.push(t),b.insertElement(t.node),w.counter+=1}),w.sortSummary()}).catch(e=>{b.togglePreloader(!1),Object(S.a)(e,b.setMessageError,E)})}]);