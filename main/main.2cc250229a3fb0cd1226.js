!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=12)}([function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(){this._handlers=[],this.setListeners=this.setListeners.bind(this)}setListeners(e){this._saveListeners(e),this._addEventListeners()}_saveListeners(e){e.forEach(e=>{let{event:t,element:s,callback:n}=e;const r=n.bind(this);this._handlers.push({event:t,element:s,bindedCallback:r})})}_addEventListeners(){this._handlers.forEach(e=>{let{event:t,element:s,bindedCallback:n}=e;"function"==typeof n&&("window"===s?window.addEventListener(t,n):"element"===s?this._element.addEventListener(t,n):this._element.querySelector(s).addEventListener(t,n))})}_removeListeners(){this._handlers.forEach(e=>{let{event:t,element:s,bindedCallback:n}=e;"window"===s?window.removeEventListener(t,n):"element"===s?this._element.removeEventListener(t,n):this._element.querySelector(s).removeEventListener(t,n)})}}},function(e,t,s){"use strict";t.a=(e,t,s)=>{t?"function"==typeof e.text?e.text().then(e=>t(JSON.parse(e).message)):"Failed to fetch"===e.message?t(s):t(e):alert(e)}},function(e,t,s){"use strict";t.a={ALREADY_EXIST_ERROR:"Такой пользователь уже есть",WRONG_EMAIL_ERROR:"Адрес почты указан в неверном формате",MISSING_VALUE_ERROR:"Необходимо заполнить поле",MISSING_SEARCH_VALUE_ERROR:"Нужно ввести ключевое слово",TYPE_SEARCH_VALUE:"Введите тему новости",PASSWORD_LENGTH_ERROR:"Пароль должен быть минимум 8 символов",NAME_LENGTH_ERROR:"Имя должно быть от 2 до 30 символов",NO_RESULT:"Ничего не найдено",NO_ARTICLES:"нет",GET_RESULT_ERROR:"Во время запроса произошла ошибка. Возможно, проблема с соединением или сервер недоступен. Подождите немного и попробуйте ещё раз",NO_INTERNET:"Проблема с Интернет-соединением"}},function(e,t,s){"use strict";t.a={SERVER_URL:"https://api.newsapp.tk",NEWSAPI_URL:"https://newsapi.org/v2/everything",NEWSAPI_TOKEN:"e36d3cbd9fac495ebacbbb8a437e8a11",ESCAPE_CODE:27,ONE_DAY:864e5,LAST_DAY:7,CARD_AMOUNT:3}},function(e,t,s){"use strict";var n=s(1);t.a=(e,t,s)=>{e.getUserData().then(e=>{t.render({isLoggedIn:!0,userName:e.data.name}),s&&s.setUsername(e.data.name)}).catch(e=>{Object(n.a)(e)})}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(0);class r extends n.a{constructor(e,t){super(),this._element=e,this._isArticlesUrl=t,this._articlesLink=this._element.querySelector(".header__list-item_articles"),this._buttonIcon=this._element.querySelector(".header__button-icon"),this._buttonText=this._element.querySelector(".header__button-text"),this._menu=this._element.querySelector(".header__menu"),this._list=this._element.querySelector(".header__list"),this._overlay=this._menu.querySelector(".header__menu-overlay")}render(e){e.isLoggedIn?(this._articlesLink.style.display="inline-block",this._buttonIcon.style.display="block",this._buttonText.textContent=e.userName):(this._articlesLink.style.display="none",this._buttonIcon.style.display="none",this._buttonText.textContent="Авторизоваться")}checkMenuState(){return!(!this._menu.classList.contains("header__menu_is-active_white")&&!this._menu.classList.contains("header__menu_is-active_black"))}toggleMenuButton(){this._isArticlesUrl?this._menu.classList.toggle("header__menu_is-active_black"):this._menu.classList.toggle("header__menu_is-active_white")}toggleMenu(){this._isArticlesUrl||this._element.classList.toggle("header_state_dropdown"),this._list.classList.toggle("header__list_is-active"),this._overlay.classList.toggle("header__menu-overlay_is-active"),document.body.classList.toggle("body_is-hidden")}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(0);class r extends n.a{constructor(e,t){super(),this._element=e,this._isArticles=t,this._message=this._element.querySelector(".results__message"),this._cardlist=this._element.querySelector(".results__list"),this._preloader=this._element.querySelector(".preloader"),this.cardsData=null,this.counter=null,this.renderedCards=[],this._initializeSearchResultsElems(),this.setMessageError=this.setMessageError.bind(this)}_initializeSearchResultsElems(){this._isArticles||(this._moreCards=this._element.querySelector(".results__button"),this._noResults=this._element.querySelector(".results__no-results"))}show(){this._isArticles||(this.toggleNoResults(!1),this.toggleMoreCards(!1)),this._message.textContent="",this.togglePreloader(!0),this._element.classList.add("results_is-active")}hide(){this._element.classList.remove("results_is-active")}insertElement(e){this._cardlist.append(e)}togglePreloader(e){e?this._preloader.classList.add("preloader_is-active"):this._preloader.classList.remove("preloader_is-active")}toggleMoreCards(e){e?this._moreCards.classList.add("results__button_active"):this._moreCards.classList.remove("results__button_active")}toggleNoResults(e){e?this._noResults.classList.add("results__no-results_is-active"):this._noResults.classList.remove("results__no-results_is-active")}setMessageError(e){this._message.textContent=e}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(0);class r extends n.a{constructor(e,t){super(),this._element=document.querySelector(t).content.cloneNode(!0).querySelector(".card__wrapper"),this._data=e,this._id=null,this._cardEventCallback=null,this._textWrapper=this._element.querySelector(".card__text-wrapper"),this._setData(this._data),this.truncateCardText=this.truncateCardText.bind(this),setTimeout(this.truncateCardText,10)}truncateCardText(){const e=this._textWrapper.clientWidth*this._textWrapper.clientHeight/245;this._element.querySelector(".card__text").textContent=`${this._data.text.substr(0,e)}...`}remove(){this._removeListeners(),this._element.remove()}_setData(e){this._element.querySelector(".card__source").textContent=e.source,this._element.querySelector(".card__title").textContent=e.title,this._element.querySelector(".card__date").textContent=r._setFormattedDate(e.date),this._element.querySelector(".card__text").textContent=e.text,this._element.querySelector(".card__image").style.backgroundImage=`url('${e.image}')`,this._element.querySelector(".card__keyword")&&(this._element.querySelector(".card__keyword").textContent=e.keyword)}static _setFormattedDate(e){const t=new Intl.DateTimeFormat("ru-RU",{day:"numeric",month:"long",year:"numeric"}),[{value:s},,{value:n},,{value:r}]=t.formatToParts(new Date(e));return`${s} ${n}, ${r}`}set id(e){this._id=e}get id(){return this._id}get node(){return this._element}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(e){this._url=e.url}static getJSONResponse(e){return e.ok?e.json():Promise.reject(e)}signup(e){const{name:t,email:s,password:r}=e;return fetch(`${this._url}/signup`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({name:t,email:s,password:r})}).then(e=>n.getJSONResponse(e))}signin(e){const{email:t,password:s}=e;return fetch(`${this._url}/signin`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({email:t,password:s})}).then(e=>n.getJSONResponse(e))}getUserData(){return fetch(`${this._url}/users/me`,{headers:{authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>n.getJSONResponse(e))}addBookmark(e){return fetch(`${this._url}/articles`,{headers:{"Content-Type":"application/json",authorization:`Bearer ${localStorage.getItem("token")}`},method:"POST",body:JSON.stringify(e)}).then(e=>n.getJSONResponse(e))}deleteBookmark(e){return fetch(`${this._url}/articles/${e}`,{headers:{"Content-Type":"application/json",authorization:`Bearer ${localStorage.getItem("token")}`},method:"DELETE"}).then(e=>n.getJSONResponse(e))}getArticles(){return fetch(`${this._url}/articles`,{headers:{authorization:`Bearer ${localStorage.getItem("token")}`}}).then(e=>n.getJSONResponse(e))}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return r}));const n=(e,t)=>{!window.matchMedia("(max-width: 650px)").matches&&e.checkMenuState()?(t.isOpened||e.toggleMenu(),e.toggleMenuButton()):window.matchMedia("(max-width: 650px)").matches&&!e.checkMenuState()&&t.isOpened&&e.toggleMenuButton()},r=e=>{!window.matchMedia("(max-width: 650px)").matches&&e.checkMenuState()&&(e.toggleMenu(),e.toggleMenuButton())}},function(e,t,s){},,function(e,t,s){"use strict";s.r(t);s(10);var n=s(3),r=s(2),i=s(5),a=s(0);const{ESCAPE_CODE:o}=n.a;class l extends a.a{constructor(e){super(),this._element=e,this._content=this._element.querySelector(".popup__content"),this._contentHandler=null,this.isOpened=!1,this._saveListeners([{event:"mousedown",element:"element",callback:this._closeHandler},{event:"keyup",element:"window",callback:this._closeHandler}])}setContent(e,t){this._contentHandler=t,this._content.appendChild(e)}open(e,t){document.body.style.overflow="hidden",this._element.classList.add("popup_is-opened"),this.setContent(e,t),this._addEventListeners(),this.isOpened=!0}clearContent(){"function"==typeof this._contentHandler&&this._contentHandler(),document.body.style.overflow="",this._content.lastChild.remove()}close(){this.clearContent(),this._element.classList.remove("popup_is-opened"),document.body.style.overflow="",this._removeListeners(),this.isOpened=!1}_closeHandler(e){(e.keyCode===o||e.target.classList.contains("popup")||e.target.classList.contains("popup__close"))&&this.close()}}const{MISSING_VALUE_ERROR:c,PASSWORD_LENGTH_ERROR:_,NAME_LENGTH_ERROR:u,WRONG_EMAIL_ERROR:d}=r.a;class h extends a.a{constructor(e){super(),this._element=document.querySelector(e).content.cloneNode(!0).querySelector(".form"),this.setSubmitError=this.setSubmitError.bind(this),this.clear=this.clear.bind(this),this.setListeners([{event:"input",element:"element",callback:this._validateHandler}])}static _inputHandler(e){const t=e.target.nextElementSibling;e.target.validity.valueMissing?t.textContent=c:e.target.validity.tooShort&&"password"===e.target.name?t.textContent=_:e.target.validity.tooShort||e.target.validity.tooShort?t.textContent=u:e.target.validity.patternMismatch?t.textContent=d:t.textContent=""}get element(){return this._element}toggleLockForm(e){const t=Array.from(this._element.elements);e?(this._clearErrors(),t.forEach(e=>{e.setAttribute("disabled",!0),"submit"===e.name&&this._element.elements.submit.classList.remove("form__submit_active")})):t.forEach(e=>{e.removeAttribute("disabled"),"submit"===e.name&&this._element.elements.submit.classList.add("form__submit_active")})}getInputValues(){const e={};return Array.from(this._element.elements).forEach(t=>{"submit"!==t.name&&(e[t.name]=t.value)}),e}setSubmitError(e){this._element.querySelector(".form__error_submit").textContent=e}clear(){this._element.reset(),this._clearErrors()}_clearErrors(){this._element.querySelectorAll(".form__error").forEach(e=>{e.textContent=""})}_checkFormValid(){return!!this._element.checkValidity()}_validateHandler(e){h._inputHandler(e),this._checkFormValid()?(this._element.elements.submit.removeAttribute("disabled"),this._element.elements.submit.classList.add("form__submit_active")):(this._element.elements.submit.setAttribute("disabled",!0),this._element.elements.submit.classList.remove("form__submit_active"))}}const{MISSING_SEARCH_VALUE_ERROR:m,TYPE_SEARCH_VALUE:g}=r.a;class p extends a.a{constructor(e){super(),this._element=e,this._input=this._element.querySelector(".search__input"),this._button=this._element.querySelector(".search__button"),this.setListeners([{event:"input",element:"element",callback:this._validateHandler}])}get input(){return this._input.value}toggleLockForm(){Array.from(this._element.elements).forEach(e=>{e.toggleAttribute("disabled"),"submit"===e.name&&this._element.elements.submit.classList.toggle("search__button_active")})}_validateHandler(e){e.target.validity.valueMissing?this._input.placeholder=m:this._input.placeholder=g,this._element.checkValidity()?(this._button.removeAttribute("disabled"),this._button.classList.add("search__button_active")):(this._button.setAttribute("disabled",!0),this._button.classList.remove("search__button_active"))}}var b=s(6),v=s(7),S=s(8);const{ONE_DAY:y}=n.a;class E{constructor(e){this._url=e.url,this._headers=e.headers,this._lastDay=e.lastDay}static getJSONResponse(e){return e.ok?e.json():Promise.reject(new Error(`Ошибка: ${e.status}`))}_getDates(){const e=new Date;return`&from=${new Date(e.getTime()-this._lastDay*y).toISOString().slice(0,10)}&to=${e.toISOString().slice(0,10)}`}getNews(e){return fetch(`${this._url}/?q=${e}${this._getDates()}&pageSize=100`,{headers:this._headers}).then(e=>E.getJSONResponse(e))}}var L=(e,t,s)=>{e.setListeners([{event:"click",element:".form__switch-link",callback:()=>{s.clearContent(),s.setContent(t.element,t.clear)}}])},f=s(4);var k=(e,t)=>(s=>{let{title:n,description:r,urlToImage:i,publishedAt:a,url:o}=s;return{title:n,text:r,image:i,date:a,link:o,keyword:`${t.input[0].toUpperCase()}${t.input.substr(1)}`,source:e.source.name}})(e);var R=e=>{e.target.classList.contains("card__corner-button_unsaved")&&!localStorage.getItem("token")&&e.target.nextElementSibling.classList.toggle("card__corner-label_active")},w=s(1),O=s(9);const{SERVER_URL:C,NEWSAPI_URL:x,NEWSAPI_TOKEN:A,LAST_DAY:N,CARD_AMOUNT:M}=n.a,{GET_RESULT_ERROR:T,NO_INTERNET:I}=r.a,q=new S.a({url:C}),D=new E({url:x,headers:{authorization:A},lastDay:N}),P=new h(".form_template-login"),j=new h(".form_template-signup"),$=new h(".form_template-success"),U=new i.a(document.querySelector(".header"),!1),H=new l(document.querySelector(".popup")),F=new p(document.querySelector(".search")),V=new b.a(document.querySelector(".results"),!1);L(P,j,H),L(j,P,H),L($,P,H),localStorage.getItem("token")&&Object(f.a)(q,U),window.addEventListener("resize",()=>Object(O.a)(U,H));U.setListeners([{event:"click",element:".header__button",callback:e=>(e=>{e.preventDefault(),localStorage.getItem("token")?(localStorage.removeItem("token"),U.render({isLoggedIn:!1})):(H.open(P.element,P.clear),window.matchMedia("(max-width: 650px)").matches&&U.toggleMenu())})(e)},{event:"click",element:".header__menu",callback:e=>(e=>{window.matchMedia("(max-width: 650px)").matches&&e.target.classList.contains("header__menu")&&(U.toggleMenuButton(),document.querySelector(".popup_is-opened")?H.close():U.toggleMenu())})(e)}]);P.setListeners([{event:"click",element:".form__submit",callback:e=>(e=>{e.preventDefault(),P.toggleLockForm(!0),q.signin(P.getInputValues()).then(e=>{P.toggleLockForm(!1),localStorage.setItem("token",e.token),Object(f.a)(q,U),H.close(),window.matchMedia("(max-width: 650px)").matches&&U.toggleMenuButton()}).catch(e=>{P.toggleLockForm(!1),Object(w.a)(e,P.setSubmitError,I)})})(e)}]),j.setListeners([{event:"click",element:".form__submit",callback:e=>(e=>{e.preventDefault(),j.toggleLockForm(!0),q.signup(j.getInputValues()).then(()=>{j.toggleLockForm(!1),H.clearContent(),H.setContent($.element)}).catch(e=>{j.toggleLockForm(!1),Object(w.a)(e,j.setSubmitError,I)})})(e)}]);const B=e=>{const t=k(e,F),s=new v.a(t,".card-template");s.setListeners([{event:"click",element:".card__corner-button",callback:e=>((e,t,s)=>{e.preventDefault(),e.stopPropagation(),localStorage.getItem("token")&&(e.target.classList.contains("card__corner-button_saved")?q.deleteBookmark(t.id).then(()=>{e.target.classList.toggle("card__corner-button_saved")}).catch(e=>{Object(w.a)(e)}):q.addBookmark(s).then(s=>{e.target.classList.toggle("card__corner-button_saved"),t.id=s.data._id}).catch(e=>{Object(w.a)(e)}))})(e,s,t)},{event:"click",element:".card",callback:()=>{window.open(t.link,"_blank")}},{event:"resize",element:"window",callback:s.truncateCardText}]),V.renderedCards.push(s),V.insertElement(s.node)};F.setListeners([{event:"click",element:".search__button",callback:e=>(e=>{e.preventDefault(),F.toggleLockForm(),V.show(),V.renderedCards.length>0&&(V.renderedCards.forEach(e=>{e.remove()}),V.renderedCards=[]),D.getNews(F.input).then(e=>{if(F.toggleLockForm(),V.togglePreloader(!1),V.cardsData=e.articles,e.articles.length>0){for(let t=0;t<M&&e.articles[t];t++)B(e.articles[t]);e.articles.length>M&&(V.toggleMoreCards(!0),V.counter=3)}else 0===e.articles.length&&V.toggleNoResults(!0)}).catch(e=>{F.toggleLockForm(),V.togglePreloader(!1),Object(w.a)(e,V.setMessageError,T)})})(e)}]),V.setListeners([{event:"click",element:".results__button",callback:()=>{for(let e=V.counter;e<V.counter+M;e++){if(!V.cardsData[e]){V.toggleMoreCards(!1);break}B(V.cardsData[e])}V.counter+=M}},{event:"mouseover",element:".results__list",callback:R},{event:"mouseout",element:".results__list",callback:R}])}]);